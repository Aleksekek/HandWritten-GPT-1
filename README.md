# HandWritten-GPT-1

# üß† NanoGPT from Scratch

–ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–∫–æ–¥–µ—Ä–Ω–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (–≤ —Å—Ç–∏–ª–µ GPT) —Å –Ω—É–ª—è –Ω–∞ PyTorch. –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–æ–≥–æ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –∏ —Å —á–µ–≥–æ –Ω–∞—á–∏–Ω–∞–ª–∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –±–æ–ª—å—à–∏–µ —è–∑—ã–∫–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (LLM).

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ú–æ–¥—É–ª–∏

–ú–æ–¥–µ–ª—å –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –ø–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **Decoder-Only Transformer** –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –∫–ª—é—á–µ–≤—ã—Ö –º–æ–¥—É–ª–µ–π:

### 1. `Embeddings.py`
*   **`TokenEmbeddings`**: –°–ª–æ–π –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —Å–ª–æ–≤. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø–ª–æ—Ç–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (`emb_size`).
*   **`PositionalEmbeddings`**: –°–ª–æ–π –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤. –ö–æ–¥–∏—Ä—É–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é –æ–±—É—á–∞–µ–º—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ `nn.Embedding` –¥–ª—è –ø–æ–∑–∏—Ü–∏–π.

### 2. `Attention.py`
*   **`HeadAttention`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ **–º–µ—Ö–∞–Ω–∏–∑–º–∞ —Å–∞–º–æ–≤–Ω–∏–º–∞–Ω–∏—è (Self-Attention)** —Å –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –ú–∞—Å–∫–∞ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ç–æ–∫–µ–Ω –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ç–æ–∫–µ–Ω—ã –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–ø—Ä–∏–Ω—Ü–∏–ø –∞–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–∏).
    *   –í—ã—á–∏—Å–ª—è–µ—Ç –º–∞—Ç—Ä–∏—Ü—ã –ó–∞–ø—Ä–æ—Å–æ–≤ (Q), –ö–ª—é—á–µ–π (K) –∏ –ó–Ω–∞—á–µ–Ω–∏–π (V).
    *   –ü—Ä–∏–º–µ–Ω—è–µ—Ç scaled dot-product attention: `softmax(Q¬∑K^T / sqrt(d_k) + M) ¬∑ V`.
*   **`MultiHeadAttention`**: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è **–º–Ω–æ–≥–æ–≥–æ–ª–æ–≤–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è**. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—ã—Ö–æ–¥—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `HeadAttention`, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ –ª–∏–Ω–µ–π–Ω—ã–π —Å–ª–æ–π –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç dropout.

### 3. `FFN.py`
*   **`FeedForward`**: –î–≤—É—Ö—Å–ª–æ–π–Ω–∞—è –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω–∞—è —Å–µ—Ç—å —Å –Ω–µ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å—é (ReLU) –∏ dropout. –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∫–∞–∂–¥–æ–º—É —Ç–æ–∫–µ–Ω—É –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.

### 4. `Decoder.py`
*   **`Decoder`**: –û–¥–∏–Ω –¥–µ–∫–æ–¥–µ—Ä–Ω—ã–π –±–ª–æ–∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
    1.  **MultiHeadAttention** ‚Üí Residual Connection ‚Üí **LayerNorm**
    2.  **FeedForward** ‚Üí Residual Connection ‚Üí **LayerNorm**
    Residual connections –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –∏—Å—á–µ–∑–∞—é—â–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤.

### 5. `GPT.py`
*   **`GPT`**: –ö–æ–Ω–µ—á–Ω–∞—è –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å—ë –≤–æ–µ–¥–∏–Ω–æ:
    *   –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ —Ç–µ–Ω–∑–æ—Ä —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏ —Ç–æ–∫–µ–Ω–æ–≤.
    *   –°—É–º–º–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω–Ω—ã–µ –∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏.
    *   –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —á–µ—Ä–µ–∑ —Å—Ç—ç–∫ –∏–∑ `N` –¥–µ–∫–æ–¥–µ—Ä–Ω—ã—Ö –±–ª–æ–∫–æ–≤ (`Decoder`).
    *   –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Å–ª–æ–≤–∞—Ä—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–∏—Ç–æ–≤.
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ç–æ–¥ `.generate()` –¥–ª—è –∞–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ä–æ–∂–¥–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **top-k** –∏ **top-p (nucleus)** —Å–µ–º–ø–ª–∏–Ω–≥–∞.
    *   –°–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥ `.fit()` –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏, –≤–∫–ª—é—á–∞—é—â–∏–π:
        *   –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞–º–∏ (`tqdm`)
        *   –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Å –ø–æ–º–æ—â—å—é `AdamW` –∏ —Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Ç–µ—Ä—å `CrossEntropyLoss`
        *   –í–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ
        *   –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ (train/validation loss)

### 6. `BPE.py`
*   –†–µ–∞–ª–∏–∑–∞—Ü–∏—è **Byte Pair Encoding (BPE)** ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Å—É–±—Å–ª–æ–≤–Ω–æ–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –≤ —Ç–∞–∫–∏—Ö –º–æ–¥–µ–ª—è—Ö, –∫–∞–∫ GPT. –ü–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ–ª—å—à–∏–º —Å–ª–æ–≤–∞—Ä—ë–º –∏ –Ω–µ–∑–Ω–∞–∫–æ–º—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.

### 7. `GetData.py`
*   **`GetData`**: –ö–ª–∞—Å—Å-–Ω–∞—Å–ª–µ–¥–Ω–∏–∫ `torch.utils.data.Dataset` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏–∑ —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
    *   –ù–∞—Ä–µ–∑–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª–∏–Ω—ã (`seq_len`).
    *   –î–ª—è –∫–∞–∂–¥–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ `x` —Ü–µ–ª—å `y` ‚Äî —ç—Ç–æ —Ç–∞ –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Å–¥–≤–∏–Ω—É—Ç–∞—è –Ω–∞ –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –≤–ø–µ—Ä–µ–¥ (–∑–∞–¥–∞—á–∞ causal language modeling).

## üîó –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (Forward Pass)

1.  **–í—Ö–æ–¥**: –ò–Ω–¥–µ–∫—Å—ã —Ç–æ–∫–µ–Ω–æ–≤ `(batch_size, seq_len)`
2.  **–≠–º–±–µ–¥–¥–∏–Ω–≥–∏**: `TokenEmbeddings` + `PositionalEmbeddings` ‚Üí `(batch_size, seq_len, emb_size)`
3.  **–î–µ–∫–æ–¥–µ—Ä—ã**: –¢–µ–Ω–∑–æ—Ä –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç—ç–∫ –±–ª–æ–∫–æ–≤ `Decoder` (–∫–∞–∂–¥—ã–π —Å –≤–Ω–∏–º–∞–Ω–∏–µ–º –∏ FFN).
4.  **–ü—Ä–æ–µ–∫—Ü–∏—è**: –§–∏–Ω–∞–ª—å–Ω—ã–π –ª–∏–Ω–µ–π–Ω—ã–π —Å–ª–æ–π `Linear(emb_size, vocab_size)` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ –≤ –ª–æ–≥–∏—Ç—ã `(batch_size, seq_len, vocab_size)`.
5.  **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è**: –ú–µ—Ç–æ–¥ `generate` –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É—è –ª–æ–≥–∏—Ç—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ç–æ–∫–µ–Ω–∞ –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–≥–æ –∫ –∫–æ–Ω—Ü—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.